# ë™ì‹œì„± ì´ìŠˆ ë¶„ì„ ë° ì œì–´ ë°©ì‹ ë„ì¶œ

## ëª©ì°¨

1. [ğŸ§ ë™ì‹œì„± ì´ìŠˆ ë°œìƒ ê°€ëŠ¥ ì‹œë‚˜ë¦¬ì˜¤](#ë™ì‹œì„±-ì´ìŠˆ-ë°œìƒ-ê°€ëŠ¥-ì‹œë‚˜ë¦¬ì˜¤-ë¶„ì„)
2. [ğŸ“ˆ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼](#ì„±ëŠ¥-í…ŒìŠ¤íŠ¸-ê²°ê³¼)
3. [ğŸ“‘ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„](#í…ŒìŠ¤íŠ¸-ê²°ê³¼-ë¶„ì„)
4. [ğŸ” ë½ ë°©ì‹ì˜ ì¥ë‹¨ì ](#ë½-ë°©ì‹ì˜-ì¥ë‹¨ì )
5. [ğŸ‘ ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥ ë½ ë°©ì‹](#ì‹œë‚˜ë¦¬ì˜¤ë³„-ê¶Œì¥-ë½-ë°©ì‹)
6. [ğŸ˜ ë§ºìœ¼ë©°](#ë§ºìœ¼ë©°)

## ğŸ§Â ë™ì‹œì„± ì´ìŠˆ ë°œìƒ ê°€ëŠ¥ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

í˜„ì¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë™ì‹œì„± ì´ìŠˆ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ’ºÂ ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½

ì¢Œì„ ë°ì´í„° ì¡°íšŒ ì‹œì ì—ëŠ” ì˜ˆì•½ì´ ê°€ëŠ¥í–ˆì§€ë§Œ, ì¡°íšŒ í›„ ìƒíƒœê°€ ì˜ˆì•½ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ëœ ê²½ìš°

```mermaid
sequenceDiagram
    participant Request1
    participant Server
    participant Request2
    Request1->Server: ì¢Œì„ ë°ì´í„° ì¡°íšŒ (AVAILABLE)
    Request2->Server: ì¢Œì„ ë°ì´í„° ì¡°íšŒ (AVAILABLE)
    Request1->Server: ì¢Œì„ ì˜ˆì•½ ìš”ì²­
    Request2->Server: ì¢Œì„ ì˜ˆì•½ ìš”ì²­
    Note over Server: ì¤‘ë³µ ì¢Œì„ ì˜ˆì•½ ë°œìƒ
```

### ğŸ’°Â ê²°ì œ ì²˜ë¦¬

ì˜ˆì•½ ë°ì´í„° ì¡°íšŒ ì‹œì ì—ëŠ” ê²°ì œê°€ ê°€ëŠ¥í–ˆì§€ë§Œ, ì¡°íšŒ í›„ ê²°ì œ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ëœ ê²½ìš°

```mermaid
sequenceDiagram
    participant Request1
    participant Server
    participant Request2
    Request1->Server: ì˜ˆì•½ ë°ì´í„° ì¡°íšŒ (ë¯¸ê²°ì œ)
    Request2->Server: ì˜ˆì•½ ë°ì´í„° ì¡°íšŒ (ë¯¸ê²°ì œ)
    Request1->Server: ê²°ì œ ìš”ì²­
    Request2->Server: ê²°ì œ ìš”ì²­
    Note over Server: ì¤‘ë³µ ê²°ì œ ë°œìƒ
```

ì¢Œì„ ë°ì´í„° ì¡°íšŒ ì‹œì ì—ëŠ” ì ìœ ëœ ì‹œì ì´ì—ˆì§€ë§Œ, ì¡°íšŒ í›„ ì˜ˆì•½ ê¸°ê°„ì´ ë§Œë£Œë˜ì–´ ì‚¬ìš©ìê°€ ì˜ˆì•½ì„ ì‹œë„í•˜ëŠ” ê²½ìš°

```mermaid
sequenceDiagram
    participant Request1
    participant Server
    participant Request2
    Request1->Server: ì¢Œì„ ë°ì´í„° ì¡°íšŒ (RESERVED)
    Note over Server: ì˜ˆì•½ ì‹œê°„ ë§Œë£Œ
    Request2->Server: ì¢Œì„ ë°ì´í„° ì¡°íšŒ (AVAILABLE)
    Request1->Server: ê²°ì œ ìš”ì²­
    Request2->Server: ì˜ˆì•½ ìš”ì²­
    Note over Server: ê²°ì œëœ ì¢Œì„ ì ìœ  ë¬¸ì œ ë°œìƒ
```

### ğŸ¦Â í¬ì¸íŠ¸ ì¶©ì „

í¬ì¸íŠ¸ ì¶©ì „ì´ ì´ë£¨ì–´ì§€ê¸° ì „ ì¡°íšŒê°€ ì´ë£¨ì–´ì ¸, ì´ë¯¸ ì¶©ì „ëœ ë¹„ìš©ì´ ë®ì–´ ì”Œì›Œì§€ëŠ” ê²½ìš°

```mermaid
sequenceDiagram
    participant Request1
    participant Server
    participant Request2
    Request1->Server: í¬ì¸íŠ¸ ì¡°íšŒ (300ì›)
    Request2->Server: í¬ì¸íŠ¸ ì¡°íšŒ (300ì›)
    Request1->Server: 500 í¬ì¸íŠ¸ ì¶©ì „
    Request2->Server: 500 í¬ì¸íŠ¸ ì¶©ì „
    Server->Request1: ì¶©ì „ ì„±ê³µ (800ì›)
    Server->Request2: ì¶©ì „ ì„±ê³µ (800ì›)
    Note over Server: ì‹¤ì œ ì”ì•¡: 800ì›<br>ì˜ˆìƒ ì”ì•¡: 1300ì›
```

## ğŸ“ˆÂ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼

ìœ„ì™€ ê°™ì€ ë™ì‹œì„± ì´ìŠˆë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ **5ê°€ì§€ ë½**ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ëŠ” **ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤**ì™€ **í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤**ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ê°ê°ì˜ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë‹¨ì¼ ìˆ˜í–‰ ë³´ì¥/ë‹¤ì¤‘ ì„±ê³µ ë³´ì¥ì´ë¼ëŠ” ìƒë°˜ëœ ìƒí™©ìœ¼ë¡œ ì˜ë¯¸ìˆëŠ” ê²°ê³¼ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

**ê°€ì •**

- 100ms ë™ì•ˆ 10ëª…, 100ëª…, 1000ëª…ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•œ ê²°ê³¼
- ìŠ¤í•€ ë½ê³¼ ë‚™ê´€ì  ë½ì˜ retry ë”œë ˆì´ ì‹œê°„ì€ 50msë¡œ ì„¤ì •
- ê°ê°ì˜ í…ŒìŠ¤íŠ¸ëŠ” 10íšŒ ë°˜ë³µ ìˆ˜í–‰
- ëª¨ë“  ìš”ì²­ì€ ë”°ë‹¥(?)ì´ ì•„ë‹Œ ì •ìƒ ìš”ì²­ìœ¼ë¡œ ê°€ì •

### ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤

```mermaid
graph TD
    A[í‰ê·  ì‘ë‹µ ì‹œê°„]

    A --> B[ë¹„ê´€ì  ë½]
    A --> C[ë‚™ê´€ì  ë½<br>No retry]
    A --> D[ë‚™ê´€ì  ë½<br>ë¬´í•œ retry]
    A --> E[ë‹¨ìˆœ ë½<br>No retry]
    A --> F[ìŠ¤í•€ ë½<br>10íšŒ retry]
    A --> G[ìŠ¤í•€ ë½<br>ë¬´í•œ retry]
    A --> H[Pub/Sub ë½]

    B --> B1[10ëª…: 101.2ms<br>100ëª…: 209.0ms<br>1000ëª…: 2023.5ms]
    C --> C1[10ëª…: 101.7ms<br>100ëª…: 128.6ms<br>1000ëª…: 988.5ms]
    D --> D1[10ëª…: 101.5ms<br>100ëª…: 228.5ms<br>1000ëª…: 1946.8ms]
    E --> E1[10ëª…: 97.9ms<br>100ëª…: 105.4ms<br>1000ëª…: 315.1ms]
    F --> F1[10ëª…: 209.2ms<br>100ëª…: 632.0ms<br>1000ëª…: 980.5ms]
    G --> G1[10ëª…: 217.6ms<br>100ëª…: 2685.4ms<br>1000ëª…: 30109.9ms]
    H --> H1[10ëª…: 113.2ms<br>100ëª…: 462.8ms<br>1000ëª…: 4499.1ms]
```

<details>
<summary>ğŸ“‹Â ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ ì„¸ë¶€ ë°ì´í„°</summary>

### 10ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock (Retry X) | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | --------- | --------------------------- | --------------------- | --------------------------- | --------------------------- | ---------- |
| 104ms     | 102ms     | 107ms                       | 98ms                  | 208ms                       | 232ms                       | 93ms       |
| 94ms      | 99ms      | 95ms                        | 107ms                 | 175ms                       | 275ms                       | 103ms      |
| 94ms      | 105ms     | 96ms                        | 99ms                  | 180ms                       | 186ms                       | 131ms      |
| 100ms     | 104ms     | 106ms                       | 106ms                 | 226ms                       | 235ms                       | 141ms      |
| 96ms      | 89ms      | 104ms                       | 103ms                 | 257ms                       | 208ms                       | 115ms      |
| 102ms     | 105ms     | 93ms                        | 96ms                  | 177ms                       | 229ms                       | 129ms      |
| 107ms     | 101ms     | 99ms                        | 79ms                  | 262ms                       | 145ms                       | 112ms      |
| 110ms     | 98ms      | 112ms                       | 105ms                 | 189ms                       | 242ms                       | 98ms       |
| 101ms     | 113ms     | 108ms                       | 91ms                  | 165ms                       | 283ms                       | 101ms      |
| 104ms     | 101ms     | 95ms                        | 95ms                  | 263ms                       | 141ms                       | 109ms      |

### 100ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock (Retry X) | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | --------- | --------------------------- | --------------------- | --------------------------- | --------------------------- | ---------- |
| 201ms     | 126ms     | 220ms                       | 110ms                 | 738ms                       | 3230ms                      | 473ms      |
| 208ms     | 125ms     | 219ms                       | 104ms                 | 602ms                       | 3297ms                      | 474ms      |
| 206ms     | 118ms     | 207ms                       | 100ms                 | 635ms                       | 2746ms                      | 491ms      |
| 233ms     | 129ms     | 234ms                       | 104ms                 | 600ms                       | 2383ms                      | 454ms      |
| 215ms     | 142ms     | 228ms                       | 102ms                 | 622ms                       | 1842ms                      | 447ms      |
| 195ms     | 130ms     | 220ms                       | 103ms                 | 615ms                       | 2505ms                      | 478ms      |
| 212ms     | 118ms     | 216ms                       | 110ms                 | 629ms                       | 1775ms                      | 444ms      |
| 208ms     | 118ms     | 249ms                       | 105ms                 | 625ms                       | 3008ms                      | 480ms      |
| 213ms     | 143ms     | 262ms                       | 103ms                 | 618ms                       | 2349ms                      | 465ms      |
| 199ms     | 137ms     | 230ms                       | 102ms                 | 636ms                       | 1715ms                      | 422ms      |

### 1000ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ (Retry X) | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock (Retry X) | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | ------------------- | --------------------------- | --------------------- | --------------------------- | --------------------------- | ---------- |
| 1914ms    | 939ms               | 2021ms                      | 299ms                 | 1238ms                      | 29322ms                     | 4308ms     |
| 2056ms    | 1066ms              | 2195ms                      | 331ms                 | 1102ms                      | 29813ms                     | 4485ms     |
| 2035ms    | 902ms               | 1512ms                      | 322ms                 | 907ms                       | 32866ms                     | 4511ms     |
| 2183ms    | 1023ms              | 1961ms                      | 322ms                 | 826ms                       | 31912ms                     | 4627ms     |
| 2166ms    | 1113ms              | 1732ms                      | 299ms                 | 819ms                       | 3223ms                      | 4185ms     |
| 2043ms    | 951ms               | 1588ms                      | 286ms                 | 846ms                       | 33926ms                     | 4766ms     |
| 1980ms    | 985ms               | 1769ms                      | 313ms                 | 930ms                       | 31129ms                     | 4394ms     |
| 2006ms    | 934ms               | 2063ms                      | 389ms                 | 863ms                       | 29132ms                     | 4895ms     |
| 1953ms    | 896ms               | 2050ms                      | 291ms                 | 1037ms                      | 30331ms                     | 4531ms     |
| 1899ms    | 1076ms              | 2577ms                      | 299ms                 | 1237ms                      | 31445ms                     | 4289ms     |

</details>

### í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤

```mermaid
graph TD
    A[í‰ê·  ì‘ë‹µ ì‹œê°„]

    A --> B[ë¹„ê´€ì  ë½]
    A --> C[ë‚™ê´€ì  ë½<br>No retry]
    A --> D[ë‚™ê´€ì  ë½<br>ë¬´í•œ retry]
    A --> E[ë‹¨ìˆœ ë½<br>No retry]
    A --> F[ìŠ¤í•€ ë½<br>10íšŒ retry]
    A --> G[ìŠ¤í•€ ë½<br>ë¬´í•œ retry]
    A --> H[Pub/Sub ë½]

    B --> B1[10ëª…: 128.8ms<br>100ëª…: 991.4ms<br>1000ëª…: 9874.9ms]
    C --> C1[10ëª…: 120.8ms / ì„±ê³µ 60%<br>100ëª…: 357.5ms / ì„±ê³µ 14%<br>1000ëª…: 4066.8ms / ì„±ê³µ 10%]
    D --> D1[10ëª…: 490.7ms<br>100ëª…: 3246.0ms<br>1000ëª…: 30146.0ms]
    E --> E1[10ëª…: 103.2ms / ì„±ê³µ 40%<br>100ëª…: 109.4ms / ì„±ê³µ 6%<br>1000ëª…: 335.5ms / ì„±ê³µ 0.3%]
    F --> F1[10ëª…: 360.3ms / ì„±ê³µ 100%<br>100ëª…: 672.0ms / ì„±ê³µ 22%<br>1000ëª…: 989.9ms / ì„±ê³µ 2.1%]
    G --> G1[10ëª…: 405.6ms<br>100ëª…: 3950.5ms<br>1000ëª…: 41949.9ms]
    H --> H1[10ëª…: 124.2ms<br>100ëª…: 1205.4ms<br>1000ëª…: 11271.0ms]
```

<details>
<summary>ğŸ“‹Â í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤ ì„¸ë¶€ ë°ì´í„°</summary>

### 10ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | --------- | --------------------------- | ----------- | --------------------------- | --------------------------- | ---------- |
| 135ms     | 133ms     | 429ms                       | 112ms       | 325ms                       | 456ms                       | 110ms      |
| 114ms     | 146ms     | 559ms                       | 100ms       | 477ms                       | 360ms                       | 144ms      |
| 121ms     | 109ms     | 573ms                       | 93ms        | 485ms                       | 261ms                       | 134ms      |
| 122ms     | 124ms     | 454ms                       | 108ms       | 235ms                       | 647ms                       | 141ms      |
| 120ms     | 99ms      | 569ms                       | 96ms        | 262ms                       | 425ms                       | 112ms      |
| 125ms     | 130ms     | 634ms                       | 103ms       | 337ms                       | 388ms                       | 132ms      |
| 137ms     | 119ms     | 384ms                       | 129ms       | 331ms                       | 452ms                       | 109ms      |
| 111ms     | 112ms     | 637ms                       | 97ms        | 284ms                       | 294ms                       | 102ms      |
| 160ms     | 123ms     | 351ms                       | 113ms       | 271ms                       | 305ms                       | 153ms      |
| 143ms     | 113ms     | 317ms                       | 81ms        | 596ms                       | 470ms                       | 105ms      |

### 100ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock (Retry X) | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | --------- | --------------------------- | --------------------- | --------------------------- | --------------------------- | ---------- |
| 920ms     | 345ms     | 3015ms                      | 111ms                 | 633ms                       | 4518ms                      | 1314ms     |
| 937ms     | 457ms     | 3237ms                      | 108ms                 | 850ms                       | 2930ms                      | 1038ms     |
| 1036ms    | 375ms     | 3348ms                      | 110ms                 | 672ms                       | 3822ms                      | 1248ms     |
| 989ms     | 334ms     | 3286ms                      | 117ms                 | 664ms                       | 4322ms                      | 1346ms     |
| 1028ms    | 335ms     | 3476ms                      | 103ms                 | 794ms                       | 5022ms                      | 1045ms     |
| 940ms     | 295ms     | 2546ms                      | 106ms                 | 871ms                       | 4899ms                      | 950ms      |
| 1157ms    | 340ms     | 2861ms                      | 119ms                 | 611ms                       | 5165ms                      | 1356ms     |
| 1102ms    | 341ms     | 3729ms                      | 107ms                 | 607ms                       | 4044ms                      | 1209ms     |
| 893ms     | 407ms     | 3198ms                      | 109ms                 | 635ms                       | 4214ms                      | 1257ms     |
| 912ms     | 346ms     | 3191ms                      | 104ms                 | 708ms                       | 3966ms                      | 1291ms     |

### 1000ëª… ìš”ì²­

| ë¹„ê´€ì  ë½ | ë‚™ê´€ì  ë½ (Retry X) | ë‚™ê´€ì  ë½ (ë¬´í•œ retry 50ms) | Simple Lock (Retry X) | Spin Lock (10íšŒ retry 50ms) | Spin Lock (ë¬´í•œ retry 50ms) | Pub/Sub ë½ |
| --------- | ------------------- | --------------------------- | --------------------- | --------------------------- | --------------------------- | ---------- |
| 8856ms    | 2964ms              | 26231ms                     | 339ms                 | 953ms                       | 43954ms                     | 14609ms    |
| 10494ms   | 3952ms              | 26624ms                     | 356ms                 | 1242ms                      | 44294ms                     | 10650ms    |
| 8686ms    | 3479ms              | 28117ms                     | 315ms                 | 1428ms                      | 41837ms                     | 11373ms    |
| 9023ms    | 3908ms              | 25993ms                     | 339ms                 | 997ms                       | 43886ms                     | 9758ms     |
| 8964ms    | 4623ms              | 50556ms                     | 381ms                 | 1291ms                      | 41990ms                     | 10545ms    |
| 8869ms    | 3520ms              | 35556ms                     | 309ms                 | 949ms                       | 43281ms                     | 10770ms    |
| 10602ms   | 4702ms              | 26524ms                     | 344ms                 | 898ms                       | 41293ms                     | 10445ms    |
| 10532ms   | 4496ms              | 27302ms                     | 308ms                 | 1157ms                      | 42256ms                     | 11995ms    |
| 10641ms   | 5028ms              | 25858ms                     | 322ms                 | 1064ms                      | 41108ms                     | 11439ms    |
| 11082ms   | 3996ms              | 28699ms                     | 342ms                 | 899ms                       | 43407ms                     | 11126ms    |

</details>

## ğŸ“‘Â í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„

### ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ íŠ¹ì§•**

- í•˜ë‚˜ì˜ ìš”ì²­ì´ ì„±ê³µë˜ë©´ ë‹¤ë¥¸ ìš”ì²­ì€ ì¶©ëŒì´ ë°œìƒí•´ë„ ë¬´ë°©
- ìš”ì²­ì˜ ì‹œì ì— ë”°ë¼ ë™ì¼ ìš”ì²­ì´ë”ë¼ë„ ì—ëŸ¬ê°€ ë°œìƒ (ì˜ˆì•½ëœ ì¢Œì„ ìƒíƒœ OR ë½ íšë“ ì‹¤íŒ¨)

**Lockë³„ ì„±ëŠ¥ ë¹„êµ ë° ë¶„ì„**

1. ìš”ì²­ ìˆ˜ì— ë”°ë¥¸ ì„±ëŠ¥ ë³€í™” (ì‘ë‹µ ë¹ ë¥¸ ìˆœ)

- 10ëª… & 100ëª… ìš”ì²­: Simple Lock > ë‚™ê´€ì  ë½ (No retry) > ë¹„ê´€ì  ë½ > Pub/Sub ë½ > Spin ë½ (10íšŒ Retry)
- 1000ëª… ìš”ì²­: Simple Lock > ë‚™ê´€ì  ë½ (No retry) > ë¹„ê´€ì  ë½ > Spin ë½ (10íšŒ Retry) > Pub/Sub ë½

2. ìš”ì²­ ìˆ˜ì™€ ì‘ë‹µì‹œê°„ì„ í†µí•œ ë°ì´í„° ë¶„ì„

   10ëª…ì˜ ìš”ì²­ì„ ì²˜ë¦¬ ì‹œ, ëŒ€ë¶€ë¶„ì˜ ë½ì´ ë¹„ìŠ·í•œ ì„±ëŠ¥ì„ ë³´ì˜€ì§€ë§Œ 1000ëª…ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•  ë•ŒëŠ” ê°€ì¥ ë¹ ë¥¸ Simple Lockê³¼ ê°€ì¥ ëŠë ¸ë˜ ë¹„ê´€ì  ë½ & Pub/Sub ë½ì˜ ì†ë„ê°€ ì•½ 10ë°° ì •ë„ ì°¨ì´ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í†µí•œ íŒë‹¨ ì‹œ, ì´ëŠ” ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì˜ íŠ¹ì§•ìœ¼ë¡œ ë‹¤ë¥¸ ë½ë“¤ì´ ë™ì‹œì  ìˆ˜í–‰ í˜¹ì€ ë¹ ë¥¸ ì—ëŸ¬ ë°œìƒìœ¼ë¡œ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒê³¼ ë‹¤ë¥´ê²Œ ëª¨ë“  ë¡œì§ì„ í•˜ë‚˜ì”© ì§ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°ì— ë°œìƒí–ˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ë˜í•œ, ì¶©ëŒì´ ì ì€ êµ¬ê°„ì—ì„œëŠ” Pub/Sub ë½ì´ Spin ë½ë³´ë‹¤ ë¹ ë¥¸ ì„±ëŠ¥ì„ ë³´ì˜€ì§€ë§Œ, 1000ê°œì˜ ìš”ì²­ì—ì„œëŠ” Spin ë½ì˜ 10íšŒ Retryë¥¼ í•¨ì—ë„ ë¡œì§ ìˆ˜í–‰ë¥  ìì²´ê°€ ë‚®ì•„ì§€ë©° Pub/Sub ë½ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì´ ë”ìš± ëŠë¦¬ê²Œ ë³´ì—¬ì¡ŒìŠµë‹ˆë‹¤.

3. ì„±ëŠ¥ ì°¨ì´ ë¶„ì„ ë° ê·¼ê±° ì œì‹œ

   **Simple ë½ vs ë‚™ê´€ì  ë½**

   Simple Lockì˜ êµ¬í˜„ ìƒ, lock íšë“ Raceë¥¼ í•œ ì´í›„ lockì„ íšë“í•˜ì§€ ëª»í•œ ìš”ì²­ë“¤ì€ Transactionì´ ìƒì„±ë˜ê¸°ë„ ì „ì— ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë°˜ë©´ì— ë‚™ê´€ì  ë½ì€ Transactionì„ ìƒì„± í›„ ë¡œì§ ìˆ˜í–‰ ì¤‘ì— ì¢Œì„ ìƒíƒœ ì²´í¬ í˜¹ì€ ì¶©ëŒë¡œ ì¸í•œ ì—ëŸ¬ ë°œìƒ í›„ Transactionì„ ë¡¤ë°± í•´ì•¼í•©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í†µí•´ ì´ ë¶€ë¶„ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”. ì´ëŸ¬í•œ íŠ¹ì§•ìœ¼ë¡œ Simple Lockì€ ìš”ì²­ì´ 100ë°° ì¦ê°€í•˜ëŠ” ìƒí™©ì—ì„œë„ í‰ê·  ì‘ë‹µ ì‹œê°„ì€ 3ë°° ì •ë„ë§Œ ì¦ê°€í•œê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë‚™ê´€ì  ë½ì€ 100ëª…ì˜ ìš”ì²­ê³¼ 1000ëª…ì˜ ìš”ì²­ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì´ ì •ì§í•˜ê²Œ 10ë°°ê°€ ì¦ê°€í•˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   **ë¹„ê´€ì  ë½ vs Pub/Sub ë½**

   ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì˜ êµ¬í˜„ì— ì‚¬ìš©ëœ ë„êµ¬ì— ì°¨ì´ê°€ ë¹„ìŠ·í•œ ë™ì‘ì„ì—ë„ ë‘ ë½ì˜ ì„±ëŠ¥ ì°¨ì´ë¥¼ ë°œìƒì‹œí‚¨ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ì •í™•í•˜ê²Œ ë§í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë ˆë””ìŠ¤ì— ì°¨ì´ë¼ê³  ìƒê°ì´ ë“¤ì—ˆëŠ”ë°ìš”. ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì œì–´ë˜ëŠ” ë¹„ê´€ì  ë½ì€ ë½ì˜ íšë“ê³¼ í•´ì œì— ëŒ€í•œ Roleì„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ê°€ê³  ì´ë¥¼ ê°ì§€í•˜ëŠ” ì‹œê°„ì´ ë¹ ë¥¼ ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤. ë°˜ë©´ì—, ë ˆë””ìŠ¤ëŠ” ë½ íšë“ê³¼ í•´ì œì˜ ê³¼ì •ì—ì„œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ê³¼ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ ê±°ì¹˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì§€ì—°ì´ ìƒëŒ€ì  ì˜¤ë²„í—¤ë“œë¡œ ë°œìƒí•œë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤. ì´ë¥¼ ë’· ë°›ì¹¨í•˜ëŠ” ë°ì´í„°ëŠ” ê°ê°ì˜ ìš”ì²­ ë³„ í‰ê·  ì‘ë‹µì‹œê°„ì…ë‹ˆë‹¤. ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì˜ ê°ê° 10, 100, 1000 ìš”ì²­ë³„ë¡œ í‰ê·  ì‘ë‹µì‹œê°„ì´ ì•½ 20ms, 250ms, 2500ms ì°¨ì´ê°€ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, transaction ë‚´ë¶€ ë¡œì§ì˜ ìˆ˜í–‰ ì‹œê°„ì€ ë™ì¼í•˜ì§€ë§Œ ì´ë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ ë³¸ì¸ì˜ ìˆœì„œë¥¼ ê°ì§€í•˜ëŠ”ê²Œ ìš”ì²­ë³„ ì•½ 2.0 ~ 2.5msê°€ ê±¸ë¦°ë‹¤ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ë¬¼ë¡  í˜„ì¬ ê°œì¸ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ ë°œìƒí•œ ë¶€ë¶„ìœ¼ë¡œ ê° í™˜ê²½ë³„ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆê² ì§€ë§Œ ìš”ì²­ë³„ ì¼ì • ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•œë‹¤ëŠ” ë¶€ë¶„ì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¶„ì„ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨ ì‹œ, ë‹¨ì¼ ì„±ê³µì´ ë³´ì¥ë˜ë©´ì„œ ë¹ ë¥´ê²Œ ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ë‚™ê´€ì  ë½ê³¼ Simple ë½ì´ ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì— ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

---

### í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ íŠ¹ì§•**

- ëª¨ë“  ìš”ì²­ì´ ìˆ˜í–‰ë˜ì–´ì•¼ í•¨
- ìš”ì²­ ìì²´ì— ë¬¸ì œê°€ ì—†ëŠ” ê²½ìš°, ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ

**Lockë³„ ì„±ëŠ¥ ë¹„êµ ë° ë¶„ì„**

1. ìš”ì²­ ìˆ˜ì— ë”°ë¥¸ ì„±ëŠ¥ ë³€í™” (ì‘ë‹µ ë¹ ë¥¸ ìˆœ)

   10ëª… ìš”ì²­: Pub/Sub ë½ -> ë¹„ê´€ì  ë½ -> Spin ë½ (ë¬´í•œ Retry) -> ë‚™ê´€ì  ë½ (ë¬´í•œ retry)
   100ëª… & 1000ëª… ìš”ì²­: ë¹„ê´€ì  ë½ -> Pub/Sub ë½ -> ë‚™ê´€ì  ë½ (ë¬´í•œ retry) -> Spin ë½ (ë¬´í•œ Retry)

2. ìš”ì²­ ìˆ˜ì™€ ì‘ë‹µì‹œê°„ì„ í†µí•œ ë°ì´í„° ë¶„ì„

   ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë‹¤ë¥´ê²Œ 10ëª…ì˜ ìš”ì²­ë¶€í„° ë½ë³„ë¡œ ì„±ëŠ¥ì°¨ì´ê°€ í¬ê²Œ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë‹¤ë¥´ê²Œ í¬ì¸íŠ¸ ì¶©ì „ì€ ë½ íšë“ ì‹¤íŒ¨ ì‹œ, ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ”ê²Œ ì•„ë‹Œ Retryë¥¼ í†µí•´ ë¡œì§ ìˆ˜í–‰ì„ ì§„í–‰í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ìš”ì²­ì˜ ìˆ˜ê°€ ì»¤ì§ˆìˆ˜ë¡ ë‚™ê´€ì  ë½ê³¼ Spin ë½ì˜ ì¶©ëŒì€ ë§ì•„ì§ˆ ìˆ˜ ë°–ì— ì—†ê³  í‰ê·  ì‘ë‹µì‹œê°„ ë˜í•œ í¬ê²Œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤. ì•ì„  ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë‹¤ë¥´ê²Œ ì´ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì´ ë‚®ì•„ì¡Œê³  ë°˜ëŒ€ë¡œ ìƒëŒ€ì ìœ¼ë¡œ ë¹¨ëë˜ ë‚™ê´€ì  ë½ê³¼ Spin ë½ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì´ ì˜¬ë¼ê°”ìŠµë‹ˆë‹¤.

3. ì„±ëŠ¥ ì°¨ì´ ë¶„ì„ ë° ê·¼ê±° ì œì‹œ

   **Spin ë½ vs ë‚™ê´€ì  ë½**

   Spin ë½ê³¼ ë‚™ê´€ì  ë½ ëª¨ë‘ ë¡œì§ì„ ìˆ˜í–‰ ì¤‘ ì‹¤íŒ¨ ì‹œ, ì„±ê³µí• ë•Œê¹Œì§€ ë¬´í•œ Retryë¥¼ í•˜ëŠ” ë¶€ë¶„ì´ ì´ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ì— ê³µí†µì ì´ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì¶©ëŒì´ ë§ì´ ë°œìƒí•˜ê³  ëª¨ë“  ë¡œì§ì„ ìˆ˜í–‰í•´ì•¼í•˜ëŠ” ì´ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì„±ëŠ¥ì´ ë§¤ìš° ë‚®ê²Œ ì¸¡ì • ë˜ì—ˆëŠ”ë°ìš”. ê·¸ëŸ¼ì—ë„ ë‘ ë½ ì‚¬ì´ì— ì„±ëŠ¥ì  ì°¨ì´ëŠ” ì•½ 30% ê°€ê¹Œì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë³´ê³  ì–´ë– í•œ ì´ìœ ë¡œ ë‚™ê´€ì  ë½ì´ Spin ë½ ë³´ë‹¤ ë¹ ë¥¸ì§€ ì˜ì•„í–ˆëŠ”ë°ìš”. ê²°êµ­ ë‚™ê´€ì  ë½ì€ ìš°ì„ ì ìœ¼ë¡œ ë¡œì§ì„ ìˆ˜í–‰ í›„ ì¶©ëŒì„ ì œì–´í•˜ëŠ” ë°˜ë©´, Spin ë½ì€ ë½ì„ íšë“í•˜ëŠ” ê³¼ì •ì—ì„œë¶€í„° ì¶©ëŒì„ ì œì–´í•˜ê³  ë½ì„ íšë“í•œ ìš”ì²­ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë¡œì§ì„ ëŒë¦¬ëŠ” ì°¨ì´ê°€ ì´ëŸ¬í•œ ì°¨ì´ë¥¼ ë§Œë“¤ì—ˆë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

   **ë¹„ê´€ì  ë½ vs Pub/Sub ë½**

   ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ê°™ì´ ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì˜ ë„êµ¬ì  ì°¨ì´ë¡œ ì˜¤ëŠ” ì„±ëŠ¥ ì°¨ì´ëŠ” ë™ì¼í•˜ë‹¤ê³  ìƒê°ì´ ë“­ë‹ˆë‹¤. ë‹¤ë§Œ, ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë¹„êµí•˜ë©´ í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë‘ ë½ì˜ ì„±ëŠ¥ ì°¨ì´ê°€ ê±°ì˜ ì—†ë‹¤ê³  ë³´ì—¬ì§€ëŠ”ë°ìš” (ì•½ 1.1ë°°). ì´ìœ ëŠ” ì „ì²´ì ì¸ ë¡œì§ ìˆ˜í–‰ì— ë“¤ì–´ê°€ëŠ” ì‹œê°„ì´ ì»¤ì ¸ì„œ ìƒëŒ€ì ìœ¼ë¡œ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì™€ ê´€ë ¨ëœ ì˜¤ë²„í—¤ë“œì˜ ë¹„ì¤‘ì´ ì ì–´ì¡Œê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë‹¬ë¦¬ ê²°êµ­ íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰ í›„ ì»¤ë°‹ì´ ì§„í–‰ë˜ì•¼ í•˜ê¸°ì— ì „ì²´ì ì¸ ìš”ì²­ì˜ í‰ê·  ì‘ë‹µì‹œê°„ì´ ê¸´ í¸ì…ë‹ˆë‹¤. ê·¸ë ‡ê¸°ì— ìš”ì²­ë³„ ì˜¤ë²„í—¤ë“œëŠ” ë¹„ìŠ·í•˜ê²Œ ì•½ 2.0 ~ 2.5msë¡œ ìœ ì§€ë˜ë”ë¼ë„ ì´ ì‹œê°„ì´ ì „ì²´ ë¡œì§ ìˆ˜í–‰ì‹œê°„ì— ë¯¸ì¹˜ëŠ” ìƒëŒ€ì  ì˜í–¥ë„ê°€ ë‚®ì•„ì¡Œë‹¤ëŠ” ê²°ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¶„ì„ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨ ì‹œ, ë‹¤ì¤‘ ì„±ê³µì´ ë³´ì¥ë˜ë©´ì„œ ê°€ì¥ ë¹ ë¥´ê²Œ ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ë¹„ê´€ì  ë½ê³¼ Pub/Sub ë½ì´ í¬ì¸íŠ¸ ì¶©ì „ ì‹œë‚˜ë¦¬ì˜¤ì— ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

## ğŸ”Â ë½ ë°©ì‹ì˜ ì¥ë‹¨ì 

| ì œì–´ ë°©ì‹  | ì¥ì                                                                     | ë‹¨ì                                                                                          |
| ---------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| ë¹„ê´€ì  ë½  | - ë°ì´í„° ì¼ê´€ì„± ë³´ì¥<br>- ì¶©ëŒ ë¹ˆë„ ë†’ì„ ë•Œ íš¨ê³¼ì <br>- ìˆœì„œ ë³´ì¥       | - DB ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±<br>- ë°ë“œë½ ìœ„í—˜                                                       |
| ë‚™ê´€ì  ë½  | - ì¶©ëŒ ì ì„ ë•Œ ë†’ì€ ì„±ëŠ¥<br>- DB ë¶€í•˜ ê°ì†Œ<br>- í™•ì¥ì„± ì¢‹ìŒ             | - ì¶©ëŒ ë§ì„ ë•Œ ì„±ëŠ¥ ì €í•˜<br>- ì¬ì‹œë„ ë¡œì§ í•„ìš”<br>- ìƒëŒ€ì  êµ¬í˜„ ë³µì¡ (ì¬ì‹œë„ ë° ì—ëŸ¬ í•¸ë“¤ë§) |
| ë‹¨ìˆœ ë½    | - êµ¬í˜„ ê°„ë‹¨<br>- ë§¤ìš° ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„                                    | - ì¶©ëŒ ì‹œ ì²˜ë¦¬ ì‹¤íŒ¨<br>- ì¬ì‹œë„ ë¡œì§ ì—†ìŒ<br>- ë‹¤ì¤‘ ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤ì— ë¶€ì í•©                   |
| ìŠ¤í•€ ë½    | - ì§§ì€ ëŒ€ê¸° ì‹œê°„ì— íš¨ê³¼ì <br>- ë†’ì€ ì²˜ë¦¬ëŸ‰ ê°€ëŠ¥<br>- ìœ ì—°í•œ ì¬ì‹œë„ ì„¤ì • | - CPU ì§‘ì•½ì <br>- ì¶©ëŒì´ ë§ì„ ë•Œ ì„±ëŠ¥ ì €í•˜                                                   |
| Pub/Sub ë½ | - ë¶„ì‚° í™˜ê²½ì— ì í•©<br>- í™•ì¥ì„± ìš°ìˆ˜<br>- ì•ˆì •ì ìœ¼ë¡œ ì›ìì  ì²˜ë¦¬ ê°€ëŠ¥    | - ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì˜ì¡´ì„± ë†’ìŒ<br>- ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì— ë¯¼ê°<br>- ìƒëŒ€ì  êµ¬í˜„ ë³µì¡                  |

## ğŸ‘Â ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥ ë½ ë°©ì‹

ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê° ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€í•œ ê¶Œì¥ ë½ ë°©ì‹ì„ ì œì‹œí•©ë‹ˆë‹¤:

1. **ì¢Œì„ ì˜ˆì•½**: ë‚™ê´€ì  ë½

   - ì¶©ëŒì´ ë°œìƒí•˜ë”ë¼ë„ í•˜ë‚˜ì˜ ì¢Œì„ë§Œ ì˜ˆì•½ì´ ë˜ë©´ ë¬¸ì œê°€ ì—†ìŒ
   - ë”°ë¼ì„œ ë‚™ê´€ì  ë½ìœ¼ë¡œ ì§„í–‰ í›„, ë½ ì¶©ëŒ í˜¹ì€ ì¢Œì„ ìƒíƒœ ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì—ëŸ¬ë¥¼ ì¼ê´„ì ìœ¼ë¡œ Retry ì—†ì´ í•¸ë“¤ë§ í•  ìˆ˜ ìˆì–´ ì„±ëŠ¥ì ìœ¼ë¡œ ìš°ìœ„

2. **ê²°ì œ ì²˜ë¦¬**: ë‚™ê´€ì  ë½ + ë¹„ê´€ì  ë½

   - ì´ë¯¸ ì§„í–‰ëœ ì˜ˆì•½ì— ëŒ€í•œ ê²°ì œë¡œ í•˜ë‚˜ì˜ ì‘ì—…ë§Œ ìˆ˜í–‰ì´ ë˜ì•¼ í•¨
   - ìƒëŒ€ì ìœ¼ë¡œ ì˜ˆì•½ ìì²´ì— ëŒ€í•œ ì¶©ëŒ ê°€ëŠ¥ì„± ì ìŒ
   - ë‹¨, í¬ì¸íŠ¸ ì‚¬ìš© ë¡œì§ì—ì„œ í¬ì¸íŠ¸ ì¶©ì „ê³¼ì˜ ìˆœì°¨ì  ì²˜ë¦¬ê°€ í•„ìš”

3. **í¬ì¸íŠ¸ ì¶©ì „ (ëª¨ë‘ ìœ íš¨í•œ ìš”ì²­ìœ¼ë¡œ ê°€ì •)**: ë¹„ê´€ì  ë½

   - ëª¨ë“  ìš”ì²­ì— ëŒ€í•œ ë¡œì§ ìˆ˜í–‰ì´ í•„ìš”
   - í¬ì¸íŠ¸ ì‚¬ìš©ê³¼ ë§ë¬¼ë ¤ ë™ì‘í•  ìˆ˜ ìˆìŒìœ¼ë¡œ, ê°ê°ì˜ ìˆ˜ì •ì´ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ê°€ í•„ìš”

## ğŸ˜Â ë§ºìœ¼ë©°

ì´ë²ˆ ë¶„ì„ì„ í†µí•´, ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ì— ë”°ë¥¸ ì ì ˆí•œ ë½ ë°©ì‹ì„ ì„ íƒí•˜ëŠ” ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ë™ì‹œì„± ì œì–´ ë°©ì‹ì„ ì§ì ‘ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ê³¼ì •ì—ì„œ, ì˜ˆìƒê³¼ ì‹¤ì œ ê²°ê³¼ ì‚¬ì´ì˜ ì°¨ì´ë¥¼ ê²½í—˜í•˜ë©° ì˜ëª» ì•Œê³  ìˆì—ˆë˜ ë¶€ë¶„ë“¤ì„ ë§ì´ ì´í•´í•˜ê²Œ ëœê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì•ìœ¼ë¡œì˜ í”„ë¡œì íŠ¸ì—ì„œ ì´ë²ˆ ë¶„ì„ì„ ê³„ê¸°ë¡œ ì²´ê³„ì ì¸ ë¶„ì„ê³¼ ê²€ì¦ ê³¼ì •ì„ í†µí•´ ë” ë‚˜ì€ ê¸°ìˆ ì  ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•´ì•¼ê² ë‹¤ê³  ëŠë‚€ ì£¼ê°„ì´ì˜€ìŠµë‹ˆë‹¤.

## ê°œìš”

ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ì´ ì˜ˆìƒë˜ëŠ” ì½˜ì„œíŠ¸ ì˜ˆì•½ ì‹œìŠ¤í…œì„ ìœ„í•œ ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. ë³¸ ì‹œìŠ¤í…œì€ ë‹¤ìˆ˜ì˜ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½ì—ì„œë„ ë™ì‹œì„± ë¬¸ì œë¥¼ ë°©ì§€í•˜ê³  ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸°ì—´ì„ ì´ìš©í•œ ìœ ì € ìœ ì…ëŸ‰ ì¡°ì ˆì„ í†µí•´ ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì´ê³  íš¨ìœ¨ì ì¸ ì½˜ì„œíŠ¸ ì˜ˆì•½ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

- ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ: ë™ì‹œì„± ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ìœ ì € ëŒ€ê¸°ì—´ ê´€ë¦¬
- ì˜ˆì•½ ê¸°ëŠ¥: ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ë° ì¢Œì„ ì¡°íšŒ, ì¢Œì„ ì˜ˆì•½ ìš”ì²­
- ê²°ì œ ê¸°ëŠ¥: ì˜ˆì•½ëœ ì¢Œì„ì— ëŒ€í•œ ê²°ì œ ì²˜ë¦¬
- ì‚¬ìš©ì ì¸ì¦: JWT ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦
- í¬ì¸íŠ¸ ê´€ë¦¬: ì”ì•¡ ì¶©ì „ ë° ì¡°íšŒ ê¸°ëŠ¥

## ê¸°ìˆ  ìŠ¤íƒ

- ë°±ì—”ë“œ: NestJS, TypeScript
- ë°ì´í„°ë² ì´ìŠ¤: PostgreSQL, TypeORM
- í…ŒìŠ¤íŠ¸: Jest (Unit, Integration, e2e)
- íŒ¨í‚¤ì§€ê´€ë¦¬: yarn

## ìš”êµ¬ ì‚¬í•­

- ê° ê¸°ëŠ¥ ë° ì œì•½ì‚¬í•­ì— ëŒ€í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë“œì‹œ í•˜ë‚˜ ì´ìƒ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë‹¤ìˆ˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ë”ë¼ë„ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ì—†ë„ë¡ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë™ì‹œì„± ì´ìŠˆë¥¼ ê³ ë ¤í•˜ì—¬ êµ¬í˜„í•©ë‹ˆë‹¤.
- ëŒ€ê¸°ì—´ ê°œë…ì„ ê³ ë ¤í•´ êµ¬í˜„í•©ë‹ˆë‹¤.

## API ëª©ë¡

ì„¸ë¶€ì ì¸ API ëª…ì„¸ëŠ” [í¬ìŠ¤íŠ¸ë§¨ Document](https://documenter.getpostman.com/view/12809852/2sA3dyhAWT)ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

- ìœ ì € í† í° ë°œê¸‰ API (`POST /users/queue`)
- ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ì¡°íšŒ API (`GET /concerts/:concertId/schedules/bookable`)
- ì˜ˆì•½ ê°€ëŠ¥ ì¢Œì„ ì¡°íšŒ API (`GET /concerts/schedules/:concertScheduleId/seats`)
- ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API (`POST /concerts/seats/:concertSeatId/book`)
- ê²°ì œ API (`POST /concerts/bookings/:concertBookingId/pay`)
- ì”ì•¡ ì¶©ì „ API (`POST /points/charge`)
- ì”ì•¡ ì¡°íšŒ API (`GET /points`)

## Milestone

í”„ë¡œì íŠ¸ì˜ ì£¼ìš” [ë§ˆì¼ìŠ¤í†¤](https://github.com/users/DongGunYoon/projects/2)ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![Milestone](asset/milestone_calendar.png)

## ERD

```mermaid
erDiagram
 UserEntity {
 int id PK
 varchar name
 timestamptz createdAt
 timestamptz updatedAt
 }
 UserQueueEntity {
 int id PK
 int userId FK
 varchar token
 timestamptz createdAt
 timestamptz expiresAt
 }
 PointEntity {
 int id PK
 int userId FK
 int amount
 timestamptz createdAt
 timestamptz updatedAt
 }
 PointHistoryEntity {
 int id PK
 int userId FK
 int pointId FK
 int amount
 enum transactionType
 timestamptz createdAt
 }
 ConcertEntity {
 int id PK
 varchar title
 varchar description
 timestamptz createdAt
 timestamptz updatedAt
 }
 ConcertScheduleEntity {
 int id PK
 int concertId FK
 timestamptz bookingStartAt
 timestamptz bookingEndAt
 timestamptz startAt
 timestamptz endAt
 timestamptz createdAt
 timestamptz updatedAt
 }
 ConcertSeatEntity {
 int id PK
 int concertId FK
 int concertScheduleId FK
 int price
 int number
 boolean isPaid
 timestamptz reservedUntil
 timestamptz createdAt
 timestamptz updatedAt
 }
 ConcertPaymentEntity {
 int id PK
 int userId FK
 int concertId FK
 int concertScheduleId FK
 int concertSeatId FK
 int concertBookingId FK
 int price
 enum type
 timestamptz createdAt
 }
 ConcertBookingEntity {
 int id PK
 int userId FK
 int concertId FK
 int concertScheduleId FK
 int concertSeatId FK
 int price
 boolean isPaid
 timestamptz expiresAt
 timestamptz createdAt
 timestamptz updatedAt
 }

 UserEntity ||--|| PointEntity : has
 UserEntity ||--o{ UserQueueEntity : has
 UserEntity ||--o{ PointHistoryEntity : has
 UserEntity ||--o{ ConcertBookingEntity : books
 UserEntity ||--o{ ConcertPaymentEntity : pays

 PointEntity ||--o{ PointHistoryEntity : has

 ConcertEntity ||--o{ ConcertScheduleEntity : schedules
 ConcertScheduleEntity ||--o{ ConcertSeatEntity : contains
 ConcertSeatEntity ||--o{ ConcertBookingEntity : bookedFor
 ConcertBookingEntity ||--o{ ConcertPaymentEntity : paidFor

```

## ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

ì•„ë˜ëŠ” ê° ì£¼ìš” APIì— ëŒ€í•œ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤. ì´ ë‹¤ì´ì–´ê·¸ë¨ë“¤ì€ ê° APIì˜ ë™ì‘ íë¦„ì„ í‘œí˜„í•©ë‹ˆë‹¤.

### ìœ ì € í† í° ë°œê¸‰ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ëŒ€ê¸°ì—´ í† í°ì„ ë°œê¸‰í•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: POST /api/user/queue

    APIGateway->>UserAuthGuard: ìœ ì € ì¸ì¦ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserAuthGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
		  APIGateway->>IssueUserQueueUseCase: ìœ ì € ëŒ€ê¸°ì—´ í† í° ë°œê¸‰ ìš”ì²­
		  IssueUserQueueUseCase->>UserQueue: ìœ ì € ëŒ€ê¸°ì—´ ì¶”ê°€ ìš”ì²­

		  UserQueue->>UserQueue: ë§Œë£Œë˜ì§€ ì•Šì€ ìœ ì € ëŒ€ê¸°ì—´ ì¡°íšŒ
		  opt ë§Œë£Œë˜ì§€ ì•Šì€ ëŒ€ê¸°ì—´ì´ ì—†ë‹¤ë©´
			  UserQueue->>UserQueue: ëŒ€ê¸°ì—´ì— ìœ ì € ìƒì„±
			end

			UserQueue-->>IssueUserQueueUseCase: ì¡°íšŒ/ìƒì„±ëœ í† í° ë°˜í™˜
			alt ìœ ì €ê°€ ì„œë¹„ìŠ¤ ì…ì¥ ê°€ëŠ¥ ìƒíƒœë©´
				IssueUserQueueUseCase->>Jwt: ìœ ì € ëŒ€ê¸°ì—´ í† í° ìƒì„± ìš”ì²­
				Jwt-->>IssueUserQueueUseCase: ìœ ì € ëŒ€ê¸°ì—´ í† í° ë°˜í™˜
				IssueUserQueueUseCase-->>ì‚¬ìš©ì: ìœ ì € ëŒ€ê¸°ì—´ í† í° ì •ë³´ ë°˜í™˜

			else ìœ ì €ê°€ ì„œë¹„ìŠ¤ ì…ì¥ ë¶ˆê°€ëŠ¥ ìƒíƒœë©´
				IssueUserQueueUseCase-->>ì‚¬ìš©ì: í˜„ì¬ ìœ ì €ì˜ ëŒ€ê¸°ì—´ ìƒíƒœë¥¼ ë°˜í™˜
			end


	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserAuthGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨
		end
```

### ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ì¡°íšŒ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ë‚ ì§œë¥¼ ì¡°íšŒí•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: GET /api/concerts/:concertId/bookable-dates

    APIGateway->>UserQueueGuard: ìœ ì € ëŒ€ê¸°ì—´ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserQueueGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
		  APIGateway->>ScanConcertBookableDatesUseCase: ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ë‚ ì§œ ì¡°íšŒ ìš”ì²­

		  ScanConcertBookableDatesUseCase->>Concert: ì½˜ì„œíŠ¸ ìœ íš¨ì„± ê²€ì¦
			alt is ìœ íš¨í•¨
			  Concert-->>ScanConcertBookableDatesUseCase: ìœ íš¨ì„± ê²€ì¦ ì„±ê³µ
  			ScanConcertBookableDatesUseCase->>ConcertSchedule: ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ìŠ¤ì¼€ì¥´ ì¡°íšŒ ìš”ì²­
  			ConcertSchedule-->>ì‚¬ìš©ì: ì¡°íšŒí•œ ì˜ˆì•½ ê°€ëŠ¥ ì½˜ì„œíŠ¸ ë‚ ì§œ ì •ë³´ ë°˜í™˜

		  else is ìœ íš¨í•˜ì§€ ì•ŠìŒ
			  Concert-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜ì„œíŠ¸ ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserQueueGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨
		end
```

### ì˜ˆì•½ ê°€ëŠ¥ ì¢Œì„ ì¡°íšŒ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì˜ˆì•½ ê°€ëŠ¥ ì¢Œì„ì„ ì¡°íšŒí•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: GET /api/concerts/schedules/:concertScheduleId/seats

    APIGateway->>UserQueueGuard: ìœ ì € ëŒ€ê¸°ì—´ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserQueueGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
		  APIGateway->>ScanConcertSeatsUseCase: ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ì¢Œì„ ì¡°íšŒ ìš”ì²­

		  ScanConcertSeatsUseCase->>ConcertSchedule: ì½˜ì„œíŠ¸ ìŠ¤ì¼€ì¥´ ìœ íš¨ì„± ê²€ì¦
			alt is ìœ íš¨í•¨
			  ConcertSchedule-->>ScanConcertSeatsUseCase: ìœ íš¨ì„± ê²€ì¦ ì„±ê³µ
  			ScanConcertSeatsUseCase->>ConcertSeat: ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ì¢Œì„ ì¡°íšŒ ìš”ì²­
  			ConcertSeat-->>ì‚¬ìš©ì: ì¡°íšŒí•œ ì˜ˆì•½ ê°€ëŠ¥ ì½˜ì„œíŠ¸ ë‚ ì§œ ì •ë³´ ë°˜í™˜

		  else is ìœ íš¨í•˜ì§€ ì•ŠìŒ
			  Concert-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜ì„œíŠ¸ ìŠ¤ì¼€ì¥´ ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserQueueGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨
		end
```

### ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì¢Œì„ ì˜ˆì•½ì„ ìš”ì²­í•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: POST /api/concerts/seats/:concertSeatId

    APIGateway->>UserQueueGuard: ìœ ì € ëŒ€ê¸°ì—´ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserQueueGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
		  APIGateway->>BookConcertSeatUseCase: ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ìš”ì²­

		  BookConcertSeatUseCase->>ConcertSchedule: ì½˜ì„œíŠ¸ ìŠ¤ì¼€ì¥´ ìœ íš¨ì„± ê²€ì¦
			alt is ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„
			  ConcertSchedule-->>BookConcertSeatUseCase: ìœ íš¨ì„± ê²€ì¦ ì„±ê³µ

  			BookConcertSeatUseCase->>ConcertSeat: ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ìš”ì²­
  			alt is ì½˜ì„œíŠ¸ ì¢Œì„ ì •ë³´ ì¡´ì¬
	  			ConcertSeat-->>BookConcertSeatUseCase: ì¡°íšŒí•œ ì˜ˆì•½ ê°€ëŠ¥ ì½˜ì„œíŠ¸ ë‚ ì§œ ì •ë³´ ë°˜í™˜
	  			alt is ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ê°€ëŠ¥ ìƒíƒœ
		  			ConcertSeat->>ConcertSeat: ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½
			  		ConcertSeat-->>BookConcertSeatUseCase: ì˜ˆì•½ëœ ì½˜ì„œíŠ¸ ì¢Œì„ ì •ë³´ ë°˜í™˜
			  		BookConcertSeatUseCase->>ConcertBooking: ì˜ˆì•½í•œ ì¢Œì„ ê´€ë ¨ ì½˜ì„œíŠ¸ ì˜ˆì•½ ìƒì„± ìš”ì²­
			  		ConcertBooking->>ConcertBooking: ì½˜ì„œíŠ¸ ì˜ˆì•½ ìƒì„±
			  		ConcertBooking-->>BookConcertSeatUseCase: ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ë°˜í™˜
			  		BookConcertSeatUseCase-->>ì‚¬ìš©ì: ì¢Œì„ ì˜ˆì•½ ìš”ì²­ ê´€ë ¨ ì •ë³´ ë°˜í™˜

		  		else is ì½˜ì„œíŠ¸ ì¢Œì„ ì˜ˆì•½ ë¶ˆê°€ëŠ¥ ìƒíƒœ
			  		ConcertSeat-->>ì‚¬ìš©ì: ì½˜ì„œíŠ¸ ì˜ˆì•½ ë¶ˆê°€ëŠ¥ ì—ëŸ¬
				  end
				else is ì½˜ì„œíŠ¸ ì¢Œì„ ë¯¸ì¡´ì¬
					ConcertSeat-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜ì„œíŠ¸ ì¢Œì„ ì—ëŸ¬
				end

		  else is ì˜ˆì•½ ë¶ˆê°€ëŠ¥ ì‹œê°„
			  ConcertSchedule-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜ì„œíŠ¸ ìŠ¤ì¼€ì¥´ ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserQueueGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨
		end
```

### ì”ì•¡ ì¶©ì „ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì”ì•¡ì„ ì¶©ì „í•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: POST /api/points/charge

    APIGateway->>UserAuthGuard: ìœ ì € ì¸ì¦ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserAuthGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
			APIGateway->>ChargeUserPointUseCase: í¬ì¸íŠ¸ ì¶©ì „ ìš”ì²­

			ChargeUserPointUseCase->>User: ìœ ì € ìœ íš¨ì„± ê²€ì¦
			alt is ìœ íš¨í•¨
			  User-->>ChargeUserPointUseCase: ìœ íš¨ì„± ê²€ì¦ ì„±ê³µ
  			ChargeUserPointUseCase->>Point: ìš”ì²­í•œ ê°’ë§Œí¼ í¬ì¸íŠ¸ ì¶©ì „

				Point->>Point: í¬ì¸íŠ¸ ì¶©ì „
				alt is ì¶©ì „ ì„±ê³µ
					Point-->>ChargeUserPointUseCase: ì¶©ì „ëœ í¬ì¸íŠ¸ ì •ë³´ ë°˜í™˜
					ChargeUserPointUseCase->>PointHistory: í¬ì¸íŠ¸ ì¶©ì „ ë‚´ì—­ ìƒì„± ìš”ì²­
					PointHistory->>PointHistory: í¬ì¸íŠ¸ ì¶©ì „ ë‚´ì—­ ìƒì„±
					ChargeUserPointUseCase-->>ì‚¬ìš©ì: í¬ì¸íŠ¸ ì •ë³´ ë°˜í™˜

				else is ì¶©ì „ ì‹¤íŒ¨
					Point-->>ì‚¬ìš©ì: ì¶©ì „ ì‹¤íŒ¨ ë°œìƒ ì—ëŸ¬
				end

		  else is ìœ íš¨í•˜ì§€ ì•ŠìŒ
			  User-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ìœ ì € ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserAuthGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨ ì—ëŸ¬
		end
```

### ì”ì•¡ ì¡°íšŒ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì”ì•¡ì„ ì¡°íšŒí•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: GET /api/points

    APIGateway->>UserAuthGuard: ìœ ì € ì¸ì¦ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserAuthGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
			APIGateway->>ReadUserPointUseCase: í¬ì¸íŠ¸ ì¡°íšŒ ìš”ì²­

			ReadUserPointUseCase->>User: ìœ ì € ìœ íš¨ì„± ê²€ì¦
			alt is ìœ íš¨í•¨
			  User-->>ReadUserPointUseCase: ìœ íš¨ì„± ê²€ì¦ ì„±ê³µ
  			ReadUserPointUseCase->>Point: í¬ì¸íŠ¸ ì¡°íšŒ ìš”ì²­
  			Point-->>ì‚¬ìš©ì: ì¡°íšŒí•œ í¬ì¸íŠ¸ ì •ë³´ ë°˜í™˜

		  else is ìœ íš¨í•˜ì§€ ì•ŠìŒ
			  User-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ìœ ì € ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserAuthGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨ ì—ëŸ¬
		end
```

### ê²°ì œ API

```mermaid
sequenceDiagram
    title ìœ ì €ê°€ ì˜ˆì•½ëœ ì¢Œì„ì„ ê²°ì œí•œë‹¤.

    ì‚¬ìš©ì->>APIGateway: POST /api/concerts/bookings/:concertBookingId/pay

    APIGateway-->>UserQueueGuard: ìœ ì € ëŒ€ê¸°ì—´ í† í° ê²€ì¦
    alt í† í° ì¸ì¦ ì„±ê³µ
		  UserQueueGuard-->>APIGateway: ì¸ì¦ ì„±ê³µ (í† í° ì •ë³´)
		  APIGateway->>PayConcertBookingUseCase: ì½˜ì„œíŠ¸ ì˜ˆì•½ ê²°ì œ ìš”ì²­

			PayConcertBookingUseCase->>ConcertBooking: ì½˜ì„œíŠ¸ ì˜ˆì•½ ìˆ˜ì • ìš”ì²­
			alt is ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ì¡´ì¬
				ConcertBooking->>ConcertBooking: ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ìˆ˜ì •
				alt is ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ìˆ˜ì • ê°€ëŠ¥
					ConcertBooking-->>PayConcertBookingUseCase: ìˆ˜ì •ëœ ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ë°˜í™˜

					PayConcertBookingUseCase->>UserPoint: í¬ì¸íŠ¸ ì°¨ê° ìš”ì²­
					alt is í¬ì¸íŠ¸ê°€ ì¶©ë¶„í•˜ë‹¤ë©´
						UserPoint->>UserPoint: í¬ì¸íŠ¸ ì°¨ê°
						PayConcertBookingUseCase->>PointHistory: í¬ì¸íŠ¸ ì°¨ê° ë‚´ì—­ ìƒì„± ìš”ì²­
						PointHistory->>PointHistory: í¬ì¸íŠ¸ ì°¨ê° ë‚´ì—­ ìƒì„±
						PayConcertBookingUseCase->>ConcertSeat: ì½˜ì„œíŠ¸ ì¢Œì„ ìƒíƒœ ìˆ˜ì • ìš”ì²­
						ConcertSeat->>ConcertSeat: ì½˜ì„œíŠ¸ ì¢Œì„ ìƒíƒœ ìˆ˜ì •
						ConcertSeat-->>PayConcertBookingUseCase: ìˆ˜ì •ëœ ì½˜ì„œíŠ¸ ì¢Œì„ ì •ë³´ ë°˜í™˜
						PayConcertBookingUseCase->>ConcertPaymentHistory: ì½˜ì„œíŠ¸ ê²°ì œ ë‚´ì—­ ìƒì„± ìš”ì²­
						ConcertPaymentHistory->>ConcertPaymentHistory: ì½˜ì„œíŠ¸ ê²°ì œ ë‚´ì—­ ìƒì„±
						ConcertPaymentHistory-->>PayConcertBookingUseCase: ì½˜ì„œíŠ¸ ê²°ì œ ë‚´ì—­ ì •ë³´ ë°˜í™˜
						PayConcertBookingUseCase->>UserQueue: ìœ ì € ëŒ€ê¸°ì—´ í† í° ë§Œë£Œ ì²˜ë¦¬ ìš”ì²­
						UserQueue->>UserQueue: ìœ ì € ëŒ€ê¸°ì—´ í† í° ë§Œë£Œ ì²˜ë¦¬
						PayConcertBookingUseCase-->>ì‚¬ìš©ì: ì˜ˆì•½ ì¢Œì„ ê²°ì œ ê´€ë ¨ ì •ë³´ ë°˜í™˜
					else is í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•˜ë‹¤ë©´
						UserPoint-->>ì‚¬ìš©ì: í¬ì¸íŠ¸ ë¶€ì¡± ì—ëŸ¬
					end

				else is ì½˜ì„œíŠ¸ ì˜ˆì•½ ì •ë³´ ìˆ˜ì • ë¶ˆê°€ëŠ¥ (ì˜ˆì•½ì ë‹¤ë¦„ OR ê²°ì œ ëŒ€ê¸° ìƒíƒœ ì•„ë‹˜)
					ConcertBooking->>ì‚¬ìš©ì: ì½˜ì„œíŠ¸ ì˜ˆì•½ ê²°ì œ ë¶ˆê°€
				end

			else is ì½˜ì„œíŠ¸ ì˜ˆì•½ ë¯¸ì¡´ì¬
				ConcertBooking-->>ì‚¬ìš©ì: ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜ì„œíŠ¸ ì¢Œì„ ì—ëŸ¬
			end

	  else í† í° ì¸ì¦ ì‹¤íŒ¨
		  UserQueueGuard-->>ì‚¬ìš©ì: ì¸ì¦ ì‹¤íŒ¨
		end
```
